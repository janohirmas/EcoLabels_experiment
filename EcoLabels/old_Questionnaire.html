{% load otree static %}
{% block content %}

<style>
    @import url(https://fonts.googleapis.com/css?family=Work+Sans:300,600);

    body {
        font-family: 'Work Sans', sans-serif;
        color: #333;
        font-weight: 300;
        text-align: center;
        background-color: #f8f6f0;
    }

    h1 {
        font-size: 1.3em;
        text-align: left;
        padding: 4vh;
        background-color: rgba(59, 121, 139, 0.678);
        color: white;
    }

    .question {
        font-size: 1.3em;
        font-style: italic;
        height: 8vh;
        margin-bottom: 8vh;
        padding: 3vh;
    }

    .answers {
        font-size: 1em;
        margin-top: 3vh;
        margin-bottom: 10vh;
        text-align: center;
    }

    .button {
        font-family: 'Work Sans', sans-serif;
        font-size: 1.2em;
        font-style: bold;
        background-color: rgb(33, 202, 132);
        color: #fff;
        border: 0px;
        border-radius: 3px;
        padding: 4vh;
        cursor: pointer;
        margin-top: 15vh;
        text-decoration: none;
    }

    .button:hover {
        background-color: rgb(39, 221, 145);
        color: #fff;
    }

    .slide {
        position: absolute;
        left: 0px;
        top: 0px;
        width: 100%;
        z-index: 1;
        opacity: 0;
        transition: opacity 0.5s;
    }

    .active-slide {
        opacity: 1;
        z-index: 2;
    }

    .quiz-container {
        position: relative;
        height: 30vh;
        margin-top: 5vh;
        background-color: white;
    }

    input[type=radio] {
        display: block;
        margin: 0 auto;
    }

    label {
        display: inline-block;
        width: 10vw;
        text-align: center;
    }

    .progress-bar {
        display: inline-block;
        width: 20vw;
        opacity: 0.7;
        text-align: center;
        -webkit-appearance: none;
        appearance: none;
    }
</style>

<body>

    <h1><strong>Questionnaire:</strong> Please indicate your agreement or disagreement with the following sentences by
        choosing one of the answer options.</h1>

    <div class="quiz-container">
        <div id="quiz"></div>
    </div>
    <a id="previous" class="button" onclick=showPreviousSlide()>Previous</a>
    <a id="next" class="button" onclick=showNextSlide()> Next</a>
    <button id="submit" class="button" onclick=showResults()>Submit</button>

    <div id="otreeData"></div>


</body>
{% endblock %}

<!-- JAVASCRIPT -->

<script>

    // This function creates the questionnaire. The object containing the questions, answers etc. can be found with the name "myQuestions". The function takes the labels and values from the object under certain question and creates slides one by one. 
    (function () {
        // Functions
        function buildQuiz() {
            // variable to store the HTML output
            const output = [];

            // for each question...
            myQuestions.forEach(
                (currentQuestion, questionNumber) => {

                    // variable to store the list of possible answers
                    const answers = [];

                    // ...add an HTML radio buttons with answer options. "Value" is the one that is going to be saved on oTree. 
                    answers.push(
                        `<div>
                      <label><input type="radio" class="QT-radio" name="question${questionNumber}" value="1"/> Strongly disagree
                      </label><label>                  
                      <input type="radio" class="QT-radio" name="question${questionNumber}" value="2"/> Disagree
                      </label><label>
                      <input type="radio" class="QT-radio" name="question${questionNumber}" value="3"/> Neutral
                      </label><label>
                      <input type="radio" class="QT-radio" name="question${questionNumber}" value="4"/> Agree
                      </label><label>
                      <input type="radio" class="QT-radio" name="question${questionNumber}" value="5"/> Strongly agree            
                    </label></div>`
                    );

                    // add this question and its answers to the output + progress bar with current amount of progress. Remember to change the "max" value of progress bar to the amount of questions you have. 
                    output.push(
                        `<div class="slide">
                    <div class="question"> ${currentQuestion.question} </div>
                    <div class="answers"> ${answers.join("")} </div>
                    <br>
                    <label> 0% </label>
                        <progress class="progress-bar" min="1" max="27" value="${questionNumber}"></progress>
                        <label> 100% </label>
                    </div>`
                    );
                }
            );

            // finally combine the output list into one string of HTML and put it on the page
            quizContainer.innerHTML = output.join('');
        }

        // the name of this function is a little bit misleading, but what it does is it collects the given responses from the questionnaire and creates hidden HTML code on the page which is used to record to answers to oTree. 
        function showResults() {

            // gather answer containers from our quiz
            const answerContainers = quizContainer.querySelectorAll('.answers');

            // for each question...
            myQuestions.forEach((currentQuestion, questionNumber) => {

                // find selected answer
                const answerContainer = answerContainers[questionNumber];
                const selector = `input[name=question${questionNumber}]:checked`;
                const userAnswer = (answerContainer.querySelector(selector) || {}).value;

                // save the user answers on oTree by creating hidden html with name that matches names in init.py
                let saveOtree = document.getElementById('otreeData');
                recordAnswer.push(
                    `<input type="hidden" name="${currentQuestion.name}" value="${userAnswer}">`
                );
                saveOtree.innerHTML = recordAnswer.join('');
            });
        }

        // This function shows the question slides one by one and shows the submit button on the last page
        function showSlide(n) {
            slides[currentSlide].classList.remove('active-slide');
            slides[n].classList.add('active-slide');
            currentSlide = n;
            if (currentSlide === 0) {
                previousButton.style.display = 'none';
            }
            else {
                previousButton.style.display = 'inline-block';
            }
            if (currentSlide === slides.length - 1) {
                nextButton.style.display = 'none';
                submitButton.style.display = 'inline-block';
            }
            else {
                nextButton.style.display = 'inline-block';
                submitButton.style.display = 'none';
            }
        }

        // slide counters
        /*function showNextSlide() {
            showSlide(currentSlide + 1);
        }*/

        function showPreviousSlide() {
            showSlide(currentSlide - 1);
        }

        // Variables

        // get questionnaire
        const quizContainer = document.getElementById('quiz');
        // get submit button
        const submitButton = document.getElementById('submit');

        // object containing questions + names. Name needs to match the name given in init.py under class Questionnaire(Page) form_fields!
        const myQuestions = [
            {
                question: "Reducing water consumption is necessary for sustainable development.",
                name: "QT1",
            },
            {
                question: "Preserving the variety of living creatures is necessary for sustainable development (preserving biological diversity).",
                name: "QT2",
            },
            {
                question: "For sustainable development, people need to be educated in how to protect themselves against natural disasters.",
                name: "QT3",
            },
            {
                question: "A culture where conflicts are resolved peacefully through discussion is necessary for sustainable development.",
                name: "QT4",
            },
            {
                question: "Respecting human rights is necessary for sustainable development.",
                name: "QT5",
            },
            {
                question: "To achieve sustainable development, all the people in the world must have access to good education.",
                name: "QT6",
            },
            {
                question: "Sustainable development requires that companies act responsibly towards their employees, customers and suppliers.",
                name: "QT7",
            },
            {
                question: "Sustainable development requires a fair distribution of goods and services among people in the world.",
                name: "QT8",
            },
            {
                question: "Wiping out poverty in the world is necessary for sustainable development.",
                name: "QT9",
            },
            {
                question: "I think that using more natural resources than we need does not threaten the health and well‐being of people in the future.",
                name: "QT10",
            },
            {
                question: "I think that we need stricter laws and regulations to protect the environment.",
                name: "QT11",
            },
            {
                question: "I think that it is important to take measures against problems which have to do with climate change.",
                name: "QT12",
            },
            {
                question: "I think that everyone ought to be given the opportunity to acquire the knowledge, values and skills that are necessary to live sustainably.",
                name: "QT13",
            },
            {
                question: "I think that we who are living now should make sure that people in the future enjoy the same quality of life as we do today.",
                name: "QT14",
            },
            {
                question: "I think that women and men throughout the world must be given the same opportunities for education and employment.",
                name: "QT15",
            },
            {
                question: "I think that companies have a responsibility to reduce the use of packaging and disposable articles.",
                name: "QT16",
            },
            {
                question: "I think it is important to reduce poverty.",
                name: "QT17",
            },
            {
                question: "I think that companies in rich countries should give employees in poor nations the same conditions as in rich countries.",
                name: "QT18",
            },
            {
                question: "I recycle as much as I can.",
                name: "QT19",
            },
            {
                question: "I always separate food waste before putting out the rubbish when I have the chance.",
                name: "QT20",
            },
            {
                question: "I have changed my personal lifestyle in order to reduce waste (e.g., throwing away less food or not wasting materials).",
                name: "QT21",
            },
            {
                question: "When I use a computer or mobile to chat, to text, to play games and so on, I always treat others as respectfully as I would in real life.",
                name: "QT22",
            },
            {
                question: "I support an aid organization or environmental group.",
                name: "QT23",
            },
            {
                question: "I show the same respect to men and women, boys and girls.",
                name: "QT24",
            },
            {
                question: "	I do things which help poor people.",
                name: "QT25",
            },
            {
                question: "I often purchase second‐hand goods over the internet or in a shop",
                name: "QT26",
            },
            {
                question: "I avoid buying goods from companies with a bad reputation for looking after their employees and the environment.",
                name: "QT27",
            },
        ];

        // Kick things off
        buildQuiz();

        // Pagination
        const previousButton = document.getElementById("previous");
        const nextButton = document.getElementById("next");
        const slides = document.querySelectorAll(".slide");
        let currentSlide = 0;

        // Show the first slide
        showSlide(currentSlide);

        // Event listeners
        submitButton.addEventListener('click', showResults);
        previousButton.addEventListener("click", showPreviousSlide);
        nextButton.addEventListener("click", showNextSlide);

        // array for saving the html with correct 
        let recordAnswer = [];

        let count = 0;

        function showNextSlide() {
            count = count + 1;

            if (count < myQuestions.length) {
            let counter = count - 1;
            const answerSelector = quizContainer.querySelectorAll('.answers');
            // for each question...
                let answerContainer2 = answerSelector[counter];
                // find selected answer
                let selection = answerContainer2.querySelector(`input[name=question${counter}]:checked`);
                console.log(selection);
                console.log(count);
                console.log(answerContainer2);
                if (selection !== null) {
                    showSlide(currentSlide + 1);
                } else {
                    count = count - 1;
                }

            }
        };
    })();



</script>